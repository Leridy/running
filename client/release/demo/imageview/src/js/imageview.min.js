var ImageView=(function(D,w){var f=w("#slideView"),n=[],z=0,u=0,o=[],F=[],c=null,I=null,E=1,e=[0,0],p=null,v=false,x=1,K=1,m=false,j=true,B=false,t=null,H=D.innerWidth,b=D.innerHeight;var C={touchstart:function(M){M.preventDefault();if(v&&M.touches&&M.touches.length>=2){var L=a();w(L).css({"-webkit-transitionDuration":"0ms","transitionDuration":"0ms"});K=E;x=y(M.touches[0].pageX,M.touches[0].pageY,M.touches[1].pageX,M.touches[1].pageY);m=true;return}M=M.touches?M.touches[0]:M;m=false;o=[M.pageX,M.pageY];F=[M.pageX,M.pageY];c=Date.now();p=-z*H;if(E!=1){e=e||[0,0];_orgZoomXY=[e[0],e[1]];var L=a();L&&(w(L).css({"-webkit-transitionDuration":"0ms","transitionDuration":"0ms"}));B=true}else{f.find(".pv-inner").css({"-webkit-transitionDuration":"0ms","transitionDuration":"0ms"});j=true}},touchmove:function(R){R.preventDefault();if(v&&R.touches&&R.touches.length>=2){var M=y(R.touches[0].pageX,R.touches[0].pageY,R.touches[1].pageX,R.touches[1].pageY);E=(M/x)*K;var Q=a();w(Q).css({"-webkit-transitionDuration":"0ms","transitionDuration":"0ms"});if(E<1){E=1;e=[0,0];w(Q).css({"-webkit-transitionDuration":"200ms","transitionDuration":"200ms"})}else{if(E>s(Q)*2){E=s(Q)*2}}w(Q).css({"-webkit-transform":"scale("+E+") translate("+e[0]+"px,"+e[1]+"px)","transform":"scale("+E+") translate("+e[0]+"px,"+e[1]+"px)"});return}if(m){return}R=R.touches?R.touches[0]:R;if(E!=1){var O=(R.pageX-o[0])/E;var N=(R.pageY-o[1])/E;o=[R.pageX,R.pageY];var Q=a();var P=Q.clientWidth*E,L=Q.clientHeight*E;var T=(P-H)/2/E,S=(L-b)/2/E;(T>=0)&&(e[0]<-T||e[0]>T)&&(O/=3);(S>0)&&(e[1]<-S||e[1]>S)&&(N/=3);e[0]+=O;e[1]+=N;(u==1&&P<H||P<H)&&(e[0]=0);(u==1&&L<b||L<b)&&(e[1]=0);w(Q).css({"-webkit-transform":"scale("+E+") translate("+e[0]+"px,"+e[1]+"px)","transform":"scale("+E+") translate("+e[0]+"px,"+e[1]+"px)"})}else{if(!j){return}var O=R.pageX-o[0];(p>0||p<-H*(u-1))&&(O/=4);p=-z*H+O;f.find(".pv-inner").css({"-webkit-transform":"translate("+p+"px,0px) translateZ(0)"})}},touchend:function(Q){if(m){return}if(E!=1){if(!B){return}var O=a();var N=O.clientWidth*E,L=O.clientHeight*E;var T=(N-H)/2/E,S=(L-b)/2/E;if(u>1&&T>=0){var R=0;var P=H/6;if(e[0]<-T-P/E&&z<u-1){R=1}else{if(e[0]>T+P/E&&z>0){R=-1}}if(R!=0){h(O);q(z+R);return}}var V=Date.now()-c;if(V<300){(V<=10)&&(V=10);var U=Math.pow(180/V,2);e[0]+=(e[0]-_orgZoomXY[0])*U;e[1]+=(e[1]-_orgZoomXY[1])*U;w(O).css({"-webkit-transition":"400ms cubic-bezier(0.08,0.65,0.79,1)","transition":"400ms cubic-bezier(0.08,0.65,0.79,1)"})}else{w(O).css({"-webkit-transition":"200ms linear","transition":"200ms linear"})}if(T>=0){if(e[0]<-T){e[0]=-T}else{if(e[0]>T){e[0]=T}}}if(S>0){if(e[1]<-S){e[1]=-S}else{if(e[1]>S){e[1]=S}}}if(Math.abs(e[0])<10){w(O).css({"-webkit-transform":"scale("+E+") translate(0px,"+e[1]+"px)","transform":"scale("+E+") translate(0px,"+e[1]+"px)"});return}else{w(O).css({"-webkit-transform":"scale("+E+") translate("+e[0]+"px,"+e[1]+"px)","transform":"scale("+E+") translate("+e[0]+"px,"+e[1]+"px)"})}B=false}else{if(!j){return}var M=p- -z*H;var R=0;if(M>50){R=-1}else{if(M<-50){R=1}}z=z+R;q(z);j=false}},click:function(L){E=1;e=[0,0];f.css("opacity","0");t=setTimeout(function(){f.css({"display":""}).html("");l()},150)},dobelTap:function(N){clearTimeout(t);var M=new Date;if(M-I<500){return}I=M;var L=a();if(!L){return}if(E!=1){h(L)}else{r(L)}},setView:function(L){H=D.innerWidth;b=D.innerHeight;f.width(D.innerWidth).height(D.innerHeight);d((-z*D.innerWidth),0,0,w(".pv-inner")[0]);h(a())}};var k=function(L){switch(L.type){case"touchstart":C.touchstart(L);break;case"touchmove":C.touchmove(L);break;case"touchcancel":case"touchend":C.touchend(L);break;case"orientationchange":case"resize":C.setView(L);break}};var g=function(){f.on("singleTap",function(M){M.preventDefault();var L=new Date;if(L-I<500){return}I=L;C.click(M);return false}).on("doubleTap",function(L){L.preventDefault();C.dobelTap(L);return false});f.on("touchstart touchmove touchend touchcancel",function(L){k(L)});C.setView();"onorientationchange" in D?D.addEventListener("orientationchange",C.setView,false):D.addEventListener("resize",C.setView,false)};var l=function(){f.off();"onorientationchange" in D?D.removeEventListener("orientationchange",C.setView,false):D.removeEventListener("resize",C.setView,false)};var y=function(M,O,L,N){return Math.sqrt(Math.pow(L-M,2)+Math.pow(N-O,2),2)};var s=function(M){var O=M.naturalHeight,L=M.naturalWidth,N=L*O/(M.clientHeight*M.clientWidth);return N};var r=function(L){var M=s(L);if(M>1){w(L).css({"-webkit-transform":"scale("+M+")","transform":"scale("+M+")","-webkit-transition":"200ms","transition":"200ms"})}E=M};var h=function(L){E=1;e=[0,0];x=1;K=1;w(L).css({"-webkit-transform":"scale(1)","transform":"scale(1)","-webkit-transition":"200ms","transition":"200ms"})};var d=function(M,L,O,N){if(!!N){N=N.style}else{return}N.webkitTransitionDuration=N.MozTransitionDuration=N.msTransitionDuration=N.OTransitionDuration=N.transitionDuration=O+"ms";N.webkitTransform="translate("+M+"px,"+L+"px)"+"translateZ(0)";N.msTransform=N.MozTransform=N.OTransform="translateX("+M+"px) translateY("+L+"px)"
};var q=function(L,M){if(L<0){L=0}else{if(L>=u){L=u-1}}z=L;d((-z*D.innerWidth),0,M?"0":"200",w(".pv-inner")[0]);w("#J_index").html(z+1+"/"+u);J()};var a=function(M){var L=f.find("li").eq(M||z).find("img");if(L.size()==1){return L[0]}else{return null}};var J=function(){if(w(".pv-img").eq(z).find("img")[0]){w("#J_loading").css("display","");return}else{w("#J_loading").css("display","block");var N=new Image(),L,M,O;N.src=n[z];w(".pv-img").eq(z)[0].appendChild(N);N.onload=function(){w("#J_loading").css("display","")}}};var A=function(){console.log("dd");f.append("<ul class='pv-inner'></ul>").append("<p class='counts'><span class='value' id='J_index'>"+(z+1)+"/"+u+"</span></p>").append("<span class='imageview-ui-loading' id='J_loading' ><i class='t1'></i><i class='t2'></i><i class='t3'></i></span>");for(var L=0;L<u;L++){w(".pv-inner").append("<li class='pv-img'></li>")}J()};var G=function(){!!f[0]||w("body").append("<div class='slide-view' id='slideView'></div>");f=w("#slideView");(navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("Android")>-1&&parseFloat(navigator.appVersion)>=4)&&(v=true)}();var i=function(L,M){n=M;z=L;u=M.length;A();f.css("display","block");f.css("opacity","1");g()};w.fn.ImageViewInit=function(){var O=w(this).find("img"),M=[];for(var N=0,L=O.length;N<L;N++){O[N].index=N;if(O[N].className.indexOf("conPic")==-1){O[N].className+=" conPic"}M.push(O[N].src)}for(var N=0;N<w(".conPic").length;N++){if(w(".conPic")[N].complete){P(w(".conPic")[N])}else{w(".conPic")[N].onload=function(){P(this)}}}function P(Q){w(Q).on("tap",function(){i(w(Q)[0].index,M)})}}})(window,Zepto);